# 数据库范式

范式(NF)可以理解为一张数据表的表结构所符合的某种设计标准的级别

## 第一范式(1NF)

第一范式中的每个属性都不可再分，第一范式是所有关系型数据库的最基本要求

```text
|     学生     | 系名 | 系主任 | 课名 | 分数 |
    /      \
| 学号 |  | 姓名 |  
```

如上的表设计是很明显应该将`学生`下的`学号`和`姓名`拆分为`学生学号`和`学生姓名`两个属性

第一范式虽然是基本要求，但其中存在如下问题:

1. 相同的系名和系主任造成大量重复数据 -> 数据冗余过大
2. 只想插入系名和系主任的信息，但是其余字段不得为空 -> 插入异常
3. 如果删除表中所有学生信息，但系名和系主任的信息也随之消失 -> 删除异常
4. 若学生的系发生改变，就要随之改变所有的相关数据 -> 修改异常

## 第二范式(2NF)

第二范式中消除了[非主属性](#非主属性)对于[码](#码)的[部分函数依赖](#部分函数依赖)

继续以第一范式中的例子解释

```text
| 学号 | 姓名 | 系名 | 系主任 | 课名 | 分数 |
```

- 码：`(学号，课名)`
- 主属性：`学号`和`课名`
- 非主属性：`姓名`、`系名`、`系主任`、`分数`

在`(学号，课名) -> 姓名`中，存在`学号 -> 姓名`，因此存在非主属性`姓名`对于`学号`的部分函数依赖，当然还存在`学号 -> 系名`和`学号 -> 系主任`的部分函数依赖

```text
| 学号 | 课名 | 分数 |
| 学号 | 姓名 | 系名 | 系主任 |
```

经过分解后，以上两张表中可以发现`分数`完全函数依赖`(学号，课名)`，而`姓名`、`系名`、`系主任`完全函数依赖`学号`，不再存在对码的部分函数依赖，因此符合了第二范式

第二范式解决了第一范式中留下的数据冗余过大和修改异常问题，但是剩下的插入异常和修改异常还未能解决

## 第三范式(3NF)

第三范式在第二范式的基础上，消除了[非主属性](#非主属性)对于[码](#码)的[传递函数依赖](#传递函数依赖)

继续以分解后的表解释，虽然第二张表满足了第二范式，但是在`学号 -> 系名`和`系名 -> 系主任`的两个函数依赖中可以发现`学号 -> 系主任`的传递函数依赖

```text
| 学号 | 课名 | 分数 |
| 学号 | 姓名 | 系名 |
| 系名 | 系主任 |
```

分解成三张表后可以发现不再存在非主属性对于码的传递依赖，因此符合第三范式

符合第三范式的数据库设计，基本上解决了数据冗余过大、插入异常、修改异常、删除异常的问题。当然，在实际中，往往为了性能上或者应对扩展的需要，经常做到2NF或者1NF也是合理的

## BCNF范式

BCNF范式在第三范式的基础上消除主属性对于码的部分与传递函数依赖

首先，来看这样一张表

```text
| 仓库名 | 管理员 | 物品名 | 数量 |
```

- 码：`(仓库名，物品名)`和`(管理员，物品名)`
- 主属性：`仓库名`、`物品名`、`管理员`
- 非主属性：`数量`

很明显不存在非主属性对码的部分和传递函数依赖，因此符合第三范式

但是比如我们只想插入一个新仓库，但还未分配管理员，此时插入很明显是失败的，因此即使是第三范式，仍然存在插入、修改、删除等异常问题

```text
| 仓库名 | 管理员 |
| 仓库名 | 物品名 | 数量 |
```

在分解成两张表后，不再存在主属性对码的部分和传递函数依赖，因此以上的插入等异常问题也被解决

## 概念解释

### 函数依赖

若在一张表中，属性或属性组X的值确定的情况下，必定能确定属性Y的值，那么就可以说Y函数依赖X，写作X -> Y

例如学号确定的情况下可以确定姓名，因此可以称为姓名函数依赖学号，`学号 -> 姓名`

### 完全函数依赖

若X -> Y，且其中X的任意一个真子集不能推导出X1 -> Y，则Y完全函数依赖X

因此若X中只有一个属性，则Y一定完全依赖X

例如`(学号，课名) -> 分数`，其中无论学号还是课名单独确定的情况下是不能确定分数的，因此这是完全依赖函数

### 部分函数依赖

若X -> Y，只要Y不完全函数依赖X，则Y部分函数依赖X

### 传递函数依赖

若X -> Y且Y -> Z，则称Z传递函数依赖X

### 码

K为表中的一个属性或属性组，若除K之外的所有属性都**完全函数依赖**K，则称K为候选码，简称码

也可以理解为在K确定的情况下，表内所有属性也都随之确定了，那么K就是码

一张表中可以存在多个候选码，从中选定一个被称为主码

超码是指候选码中包含不必要的属性时，则不能称之为候选码，而是超码

例如`(学号，课名)`就是该表的码

### 主属性

包含在任何一个码中的属性称为主属性

例如`(学号，课名)`中`学号`和`课名`就是主属性

### 非主属性

不是[主属性](#主属性)的其余属性就是非主属性

## 参考资料

- [知乎最高票的回答](https://www.zhihu.com/question/24696366)
