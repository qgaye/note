# 如何设计一个秒杀系统

秒杀架构：

1. 数据尽量少：上传和返回的数据量尽量少，因为数据在网络传输和压缩编码都是消耗性能的时间的
2. 请求数尽量少：每多一次请求就多建立一个连接，建立连接需要做三次握手
3. 路径尽量短：发起请求到返回结果的过程中经过的中间节点数要少，首先每经过一个节点都需要新建一个Socket连接，此外每多经过一个节点也就增加了新的不确定性
4. 依赖尽量少：减少强依赖，也就是必须的上下游服务，对于弱依赖的上下游服务，必要时可以降级
5. 不要有单点：没有备份，即风险不可控，通过冗余部署避免

具体措施：

1. 把秒杀系统独立拆分成一个单独系统
2. 将秒杀系统单独部署在一个集群上，这样秒杀流量就不会影响正常流量了
3. 将热点数据（比如库存）单独放到一个缓存系统中
4. 增加答题秒杀，拦截非人为流量
5. 页面动静分离，秒杀时无需刷新整个页面，而只需要点击指定按钮，减少数据请求量
6. 增加限流和降级

动静分离：静态数据要尽量离用户近，比如CDN或直接缓存在客户端，但CDN的优势在于可以主动置失效

热点数据：

及时发现热点数据：
1. 静态热点数据：可预知的，比如商家主动申报的热点商品
2. 动态热点数据：不可预知的，需要通过大数据实时分析得出

如何发现动态热点数据：
1. 异步收集交易链路上各个环节热点key（如缓存、rpc等）
2. 热点上报，将交易链路上各个环节收集到的热点key信息上报到统一热点数据分析平台
3. 统一热点数据分析平台对热点key数据进行分析，并将对应的热点信息推送给交易链路上的各个服务（这些服务需要先向热点数据分析平台订阅）

处理热点数据：
1. 优化：缓存热点数据
2. 限制：将流量hash分桶，防止热点数据请求抢占太多资源，而其他请求始终得不到资源
3. 隔离：将热点数据流量隔离出来，不要让热点流量影响到剩余所有流量，并且隔离出来后更方便针对性优化
   1. 业务隔离：将秒杀做成一种营销活动，保证秒杀的热点数据可以做预热
   2. 系统隔离：运行隔离，秒杀单独作为一个系统发布部署
   3. 数据隔离：将秒杀的热点数据放在单独缓存或DB中

